<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Structural Engineering Trivia</title>
<style>
  body {
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: radial-gradient(circle at top, #f0f4f8, #dbe9f4);
    color: #002b45;
    max-width: 800px;
    margin: 2rem auto;
    padding: 1.5rem;
  }
  h1 {
    text-align: center;
    color: #003366;
  }
  .question-box {
    background: white;
    border: 2px solid #007acc;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
  }
  button {
    display: block;
    margin: 0.5rem 0;
    padding: 0.6rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #bbb;
    background-color: #fefefe;
    color: #002b45;
    cursor: pointer;
    width: 100%;
  }
  button:hover {
    background-color: #005fa3;
    color: white;
  }
  .code-ref {
    font-size: 0.9rem;
    color: #666;
    margin-top: 1rem;
  }
  #summary {
    text-align: center;
    font-weight: bold;
    font-size: 1.2rem;
  }
</style>
</head>
<body>

<h1>Structural Engineering Trivia</h1>
<div id="questionContainer"></div>
<div id="summary"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  // Replace this with your deployed Apps Script URL
  const QUESTIONS_URL = 'https://script.google.com/macros/s/AKfycbxtf7eg9wXScP4J3xEUCrDx8_zAiv5-h0KBxlagMctbLaZYhXkKjz2-7_XScm_FH3fr/exec';

  let questions = [];
  let currentQuestionIndex = 0;
  let correctCount = 0;

  async function loadQuestions() {
    try {
      const res = await fetch(QUESTIONS_URL);
      if (!res.ok) throw new Error('Failed to load questions');
      questions = await res.json();
      // Filter approved questions only
      questions = questions.filter(q => q.approved.toString().toLowerCase() === 'yes');
      if (questions.length === 0) {
        document.getElementById('questionContainer').innerHTML = '<p>No questions available.</p>';
        return;
      }
      showQuestion();
    } catch (e) {
      document.getElementById('questionContainer').innerHTML = `<p>Error loading questions: ${e.message}</p>`;
    }
  }

  function showQuestion() {
    if (currentQuestionIndex >= questions.length) {
      showSummary();
      return;
    }
    const q = questions[currentQuestionIndex];
    const answers = [...q.incorrect, q.correct].sort(() => Math.random() - 0.5);

    const container = document.getElementById('questionContainer');
    container.innerHTML = `
      <div class="question-box">
        <p><strong>Q${currentQuestionIndex + 1}:</strong> ${q.question}</p>
        <div id="answers"></div>
        <div class="code-ref">
          <div><strong>Code Book:</strong> ${q.codebook.toUpperCase()}</div>
          <div><strong>Reference:</strong> ${q.codeRef}</div>
        </div>
      </div>
    `;

    const answersDiv = document.getElementById('answers');
    answersDiv.innerHTML = '';

    answers.forEach(answer => {
      const btn = document.createElement('button');
      btn.textContent = answer;
      btn.onclick = () => handleAnswer(answer === q.correct);
      answersDiv.appendChild(btn);
    });
  }

  function handleAnswer(isCorrect) {
    if (isCorrect) correctCount++;
    currentQuestionIndex++;
    showQuestion();
  }

  function showSummary() {
    document.getElementById('questionContainer').innerHTML = '';
    document.getElementById('summary').innerHTML = `Quiz Complete! Your score: ${correctCount} out of ${questions.length}`;
  }

  // Start loading questions on page load
  window.onload = loadQuestions;
</script>

</body>
</html>
